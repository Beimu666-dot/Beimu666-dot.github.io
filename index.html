<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>紫-粉色粒子背景倒计时</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      overflow: hidden; 
      background: #000; 
      height: 100vh; 
    }
    /* 倒计时文字样式 */
    .countdown {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      font-family: 'Arial', sans-serif;
      font-size: 15vw;
      color: #fff;
      text-shadow: 0 0 20px rgba(255,255,255,0.8);
      opacity: 0;
      transition: opacity 0.5s;
    }
    .countdown.active { opacity: 1; }
  </style>
</head>
<body>
  <!-- 倒计时容器 -->
  <div class="countdown">3</div>

  <!-- Three.js 依赖 -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/particles/THREE.PointsMaterial.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/geometries/BufferGeometry.js"></script>

  <script>
    // ======================
    // 1. 初始化 Three.js 场景
    // ======================
    let scene, camera, renderer, points;
    function initThreeJS() {
      // 场景
      scene = new THREE.Scene();
      // 相机（透视相机）
      camera = new THREE.PerspectiveCamera(
        75, 
        window.innerWidth / window.innerHeight, 
        0.1, 
        1000
      );
      camera.position.z = 5;

      // 渲染器
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // 2. 创建粒子几何体（BufferGeometry）
      const geometry = new THREE.BufferGeometry();
      const count = 10000; // 粒子数量
      const positions = new Float32Array(count * 3); // 每个粒子 x,y,z
      const colors = new Float32Array(count * 3);     // 每个粒子 rgb

      // 填充数据：随机分布在球体范围内
      for (let i = 0; i < count; i++) {
        // 位置：球体随机分布
        const x = (Math.random() - 0.5) * 10;
        const y = (Math.random() - 0.5) * 10;
        const z = (Math.random() - 0.5) * 10;
        positions.set([x, y, z], i * 3);

        // 颜色：随机紫金色/粉色
        const color = Math.random() > 0.5 
          ? new THREE.Color(0x9c4eff) // 紫金色
          : new THREE.Color(0xff69b4); // 粉色
        colors.set([color.r, color.g, color.b], i * 3);
      }

      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

      // 3. 粒子材质（PointsMaterial）
      const material = new THREE.PointsMaterial({
        size: 0.03,          // 粒子大小
        vertexColors: true,  // 使用顶点颜色
        transparent: true,   // 透明
        blending: THREE.AdditiveBlending // 叠加混合（更梦幻）
      });

      // 4. 创建粒子对象
      points = new THREE.Points(geometry, material);
      scene.add(points);

      // 监听窗口变化
      window.addEventListener('resize', onWindowResize);
    }

    // 窗口变化时更新渲染器和相机
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // ======================
    // 2. 粒子动画逻辑（随时间波动）
    // ======================
    let time = 0;
    function animateParticles() {
      time += 0.01;
      const positions = points.geometry.attributes.position.array;
      for (let i = 0; i < positions.length; i += 3) {
        // 让粒子沿 z 轴波动（正弦曲线）
        const x = positions[i];
        const y = positions[i + 1];
        const z = positions[i + 2];
        positions[i + 2] = z + Math.sin(x * 10 + time) * 0.1;
      }
      points.geometry.attributes.position.needsUpdate = true;
    }

    // ======================
    // 3. 整体动画循环
    // ======================
    function animate() {
      requestAnimationFrame(animate);
      // 更新粒子波动
      animateParticles();
      // 渲染场景
      renderer.render(scene, camera);
    }

    // ======================
    // 4. 倒计时逻辑
    // ======================
    const countdownEl = document.querySelector('.countdown');
    let current = 3;

    function startCountdown() {
  console.log("倒计时开始"); // 调试输出
  countdownEl.classList.add('active');
  const timer = setInterval(() => {
    console.log("当前计数:", current); // 调试输出
    if (current > 1) {
      current--;
      countdownEl.textContent = current;
    } else {
      console.log("准备跳转"); // 调试输出
      clearInterval(timer);
      setTimeout(() => {
        console.log("触发跳转"); // 调试输出
        setTimeout(() => {
  window.location.href = "fireworks.html"; // 强制跳转
}, 1000);
      }, 1000);
    }
  }, 1000);
}
    // ======================
    // 5. 初始化执行
    // ======================
    initThreeJS();   // 初始化 Three.js
    animate();       // 启动动画循环
    startCountdown();// 启动倒计时
  </script>
</body>
</html>
